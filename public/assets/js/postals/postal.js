$(document).ready((function(){"use strict";$("#date, #editDate").datetimepicker(DatetimepickerDefaults({format:"YYYY-MM-DD",useCurrent:!0,sideBySide:!0})),$(tableName).DataTable({processing:!0,serverSide:!0,order:[[0,"asc"]],ajax:{url:postalUrl},columnDefs:[{targets:[3],className:"text-center",width:"12%"},{targets:"_all",defaultContent:"N/A"},{targets:[4,5],orderable:!1,className:"text-center",width:"8%"}],columns:[{data:function(e){return"2"==ispostal?e.to_title:e.from_title},name:"2"==ispostal?"to_title":"from_title"},{data:"reference_no",name:"reference_no"},{data:function(e){return"2"==ispostal?e.from_title:e.to_title},name:"2"==ispostal?"from_title":"to_title"},{data:function(e){return isEmpty(e.date)?"N/A":e.date},name:"date"},{data:function(e){return""!=e.document_url?'<a href="'+postalUrl+"/"+e.id+'">Download</a>':"N/A"},name:"id"},{data:function(e){var t=[{id:e.id}];return prepareTemplateRender("#postalTemplate",t)},name:"id"}]}),$(document).on("submit","#addNewForm",(function(e){e.preventDefault(),$("#btnSave").attr("disabled",!0);var t=jQuery(this).find("#btnSave");t.button("loading");var a=new FormData($(this)[0]);$.ajax({url:postalCreateUrl,type:"POST",data:a,processData:!1,contentType:!1,success:function(e){e.success&&(displaySuccessMessage(e.message),$("#addModal").modal("hide"),$(tableName).DataTable().ajax.reload(null,!1),setTimeout((function(){t.button("reset")}),1e3))},error:function(e){printErrorMessage("#validationErrorsBox",e),setTimeout((function(){t.button("reset")}),1e3)}})})),$(document).on("click",".delete-btn",(function(e){var t=$(e.currentTarget).data("id");deleteItem(postalUrl+"/"+t,tableName,name)})),$(document).on("click",".edit-btn",(function(e){if(!ajaxCallIsRunning){ajaxCallInProgress();var t=$(e.currentTarget).data("id");renderData(t)}})),window.renderData=function(e){$.ajax({url:postalUrl+"/"+e+"/edit",type:"GET",success:function(e){if(e.success){var t=e.data.document_url.split(".").pop().toLowerCase();"pdf"==t?$("#editPreviewImage").attr("src",pdfDocumentImageUrl):"docx"==t||"doc"==t?$("#editPreviewImage").attr("src",docxDocumentImageUrl):""==t?$("#editPreviewImage").attr("src",defaultDocumentImageUrl):$("#editPreviewImage").attr("src",e.data.document_url),$(hiddenId).val(e.data.id),$("#editFromTitle").val(e.data.from_title),$("#editDate").val(e.data.date?format(e.data.date,"YYYY-MM-DD"):""),$("#editReferenceNumber").val(e.data.reference_no),$("#editToTitle").val(e.data.to_title),$("#editAddress").val(e.data.address),isEmpty(e.data.document_url)?$("#documentUrl").text(""):($("#documentUrl").html("View"),$("#documentUrl").attr("href",e.data.document_url)),$("#editModal").modal("show"),ajaxCallCompleted()}},error:function(e){manageAjaxErrors(e)}})},$(document).on("submit","#editForm",(function(e){e.preventDefault(),$("#btnEditSave").attr("disabled",!0);var t=jQuery(this).find("#btnEditSave");t.button("loading");var a=$(hiddenId).val(),r=postalUrl+"/"+a,o={formSelector:$(this),url:r,type:"post",tableSelector:tableName};editRecord(o,t),$("#editModal").modal("hide")})),$("#addModal").on("hidden.bs.modal",(function(){resetModalForm("#addNewForm","#validationErrorsBox"),$("#previewImage").attr("src",defaultDocumentImageUrl)})),$("#editModal").on("hidden.bs.modal",(function(){resetModalForm("#editForm","#editValidationErrorsBox1"),$("#previewImage").attr("src",defaultDocumentImageUrl)})),$(document).on("change","#attachment",(function(){var e=isValidDocument($(this),"#validationErrorsBox");isEmpty(e)||0==e||($("#validationErrorsBox").html("").hide(),displayDocument(this,"#previewImage",e))})),$(document).on("change","#editAttachment",(function(){var e=isValidDocument($(this),"#editModal #editValidationErrorsBox1");isEmpty(e)||0==e||displayDocument(this,"#editPreviewImage",e)})),window.isValidDocument=function(e,t){var a=$(e).val().split(".").pop().toLowerCase();return-1==$.inArray(a,["png","jpg","jpeg","pdf","doc","docx"])?($(e).val(""),$(t).html(documentError).removeClass("display-none"),$(t).removeAttr("style"),!1):($(t).html(documentError).addClass("display-none"),a)}}));