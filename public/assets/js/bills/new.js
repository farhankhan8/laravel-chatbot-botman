$('input:text:not([readonly="readonly"])').first().blur(),$(document).ready((function(){"use strict";$("#female,#male").attr("disabled",!0),$("#patient_id,#patientAdmissionId").select2({width:"100%"});var t=function(t){$(t).select2({placeholder:"Select Medicine",width:"100%"})};t(".accountId");var e=$("#bill_date");e.datetimepicker(DatetimepickerDefaults({format:"YYYY-MM-DD LT",useCurrent:!1,maxDate:moment()})),e.val(billDate),$(document).on("click","#addItem",(function(){var e={medicines:associateMedicines,uniqueId},i=prepareTemplateRender("#billItemTemplate",e);$(".bill-item-container").append(i),t(".medicineId"),uniqueId++,a()}));var a=function(){var t=1;$(".bill-item-container>tr").each((function(){$(this).find(".item-number").text(t),t++})),t-1==0&&$("#billTbl tbody").append('<tr><td class="text-center item-number">1</td><td class="table__item-desc"><input class="form-control itemName" required name="item_name[]" type="text"></td><td class="table__qty"><input class="form-control qty quantity" required name="qty[]" type="text"></td><td><input class="form-control price-input price" required name="price[]" type="text"></td><td class="amount text-right itemTotal"></td><td class="text-center"><i class="fa fa-trash text-danger delete-invoice-item pointer"></i></td></tr>')};$(document).on("click",".delete-invoice-item",(function(){$(this).parents("tr").remove(),a(),l()}));var i=function(t){return t.replace(/,/g,"")};$(document).on("keyup",".qty",(function(){var t=parseInt($(this).val()),e=$(this).parent().siblings().find(".price").val();e=parseInt(i(e));var a=n(t,e);$(this).parent().siblings(".amount").text(addCommas(a.toString())),l()})),$(document).on("keyup",".price",(function(){var t=$(this).val();t=parseInt(i(t));var e=parseInt($(this).parent().siblings().find(".qty").val()),a=n(e,t);$(this).parent().siblings(".amount").text(addCommas(a.toString())),l()}));var n=function(t,e){return t>0&&e>0?t*e:0},l=function(){var t=0;$(".bill-item-container>tr").each((function(){var e=$(this).find(".itemTotal").text();e=i(e),e=isEmpty($.trim(e))?0:parseInt(e),t+=e})),t=parseFloat(t),$("#total").text(addCommas(t.toFixed(2))),$("#totalAmount").val(t)};$(document).on("submit","#billForm",(function(t){t.preventDefault(),screenLock(),$("#saveBtn").attr("disabled",!0);var e=jQuery(this).find("#saveInvoiceBtn");e.button("loading");var a=new FormData($(this)[0]);$.ajax({url:billSaveUrl,type:"POST",dataType:"json",data:a,processData:!1,contentType:!1,success:function(t){displaySuccessMessage(t.message),window.location.href=billUrl+"/"+t.data.id},error:function(t){printErrorMessage("#validationErrorsBox",t),$("#saveBtn").attr("disabled",!1)},complete:function(){screenUnLock(),e.button("reset")}})})),$("#patientAdmissionId").on("change",(function(){var t;screenLock(),t=isEdit?{editBillId:billId,patient_admission_id:$(this).val()}:{patient_admission_id:$(this).val()},$.ajax({url:patientAdmissionDetailUrl,type:"GET",data:t,success:function(t){if(t.success){var e=t.data;if($("#pAdmissionId").val($("#patientAdmissionId").find(":selected").val()),$("#female,#male").attr("disabled",!0),$("#patientId").val(e.patientDetails.owner_id),$("#name").val(e.patientDetails.full_name),$("#userEmail").val(e.patientDetails.email),$("#userPhone").val(null!=e.patientDetails.phone?e.patientDetails.phone:"N/A"),1==e.patientDetails.gender?$("#female").prop("checked",!0):$("#male").prop("checked",!0),$("#dob").val(null!=e.patientDetails.dob?e.patientDetails.dob:"N/A"),$("#doctorId").val(e.doctorName),$("#admissionDate").val(e.admissionDetails.admission_date),$("#dischargeDate").val(null!=e.admissionDetails.discharge_date?e.admissionDetails.discharge_date:"N/A"),""!=e.package?$("#packageId").val(null!=e.package.name?e.package.name:"N/A"):$("#packageId").val("N/A"),null!=e.admissionDetails.insurance?$("#insuranceId").val(e.admissionDetails.insurance.name):$("#insuranceId").val("N/A"),$("#totalDays").val(e.admissionDetails.totalDays),$("#policyNo").val(""!=e.admissionDetails.policy_no?e.admissionDetails.policy_no:"N/A"),(""!=e.package||""==e.package||!e.hasOwnProperty("billItems")||e.hasOwnProperty("billItems")||e.billItems.length<=0||e.billItems.length>=0)&&($(".bill-item-container tr").each((function(){$(this).closest("tr").remove()})),$("#total").text("0"),$("#billTbl tbody").append('<tr><td class="text-center item-number">1</td><td class="table__item-desc"><input class="form-control itemName" required name="item_name[]" type="text"></td><td class="table__qty"><input class="form-control qty quantity" required name="qty[]" type="text"></td><td><input class="form-control price-input price" required name="price[]" type="text"></td><td class="amount text-right itemTotal"></td><td class="text-center"><i class="fa fa-trash text-danger delete-invoice-item pointer"></i></td></tr>')),""!=e.package&&e.hasOwnProperty("billItems")&&e.billItems.length>0){var a=e.billItems.length-1;$("#totalAmount").val(0);for(var i=0,n=1;n<=a;n++)$("#addItem").trigger("click");$(".bill-item-container tr").each((function(t){var a=$(this);a.find(".itemName").val(e.billItems[t].item_name),a.find(".quantity").val(e.billItems[t].qty),a.find(".price").val(e.billItems[t].price),a.find(".amount").text(e.billItems[t].amount),i+=parseInt(a.find(".itemTotal").text()),$("#total").text(i)})),$("#totalAmount").val($("#total").text()),setTimeout((function(){$(".price").trigger("keyup")}),500)}else if(""!=e.package){if(e.package.package_services_items.length>0){var l=e.package.package_services_items.length-1;$("#totalAmount").val(0);for(var s=0,r=1;r<=l;r++)$("#addItem").trigger("click");$(".bill-item-container tr").each((function(t){var a=$(this);a.find(".itemName").val(e.package.package_services_items[t].service.name),a.find(".quantity").val(e.package.package_services_items[t].quantity),a.find(".price").val(e.package.package_services_items[t].rate),a.find(".amount").text(e.package.package_services_items[t].amount),s+=parseInt(a.find(".itemTotal").text()),$("#total").text(s)})),$("#totalAmount").val($("#total").text())}}else if(e.hasOwnProperty("billItems")&&e.billItems.length>0){var o=e.billItems.length-1;$("#totalAmount").val(0);for(var c=0,d=1;d<=o;d++)$("#addItem").trigger("click");$(".bill-item-container tr").each((function(t){var a=$(this);a.find(".itemName").val(e.billItems[t].item_name),a.find(".quantity").val(e.billItems[t].qty),a.find(".price").val(e.billItems[t].price),a.find(".amount").text(e.billItems[t].amount),c+=parseInt(a.find(".itemTotal").text()),$("#total").text(c)})),$("#totalAmount").val($("#total").text())}}},error:function(t){manageAjaxErrors(t)},complete:function(t){screenUnLock()}})}))}));