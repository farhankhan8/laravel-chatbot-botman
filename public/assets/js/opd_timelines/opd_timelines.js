$(document).ready((function(){"use strict";getOpdTimelines($("#opdPatientDepartmentId").val()),$("#timelineDate, #editTimelineDate").datetimepicker(DatetimepickerDefaults({format:"YYYY-MM-DD",useCurrent:!0,sideBySide:!0,minDate:moment(appointmentDate).format("YYYY-MM-DD")})),$(document).on("submit","#addOpdTimelineNewForm",(function(e){e.preventDefault();var i=jQuery(this).find("#btnOpdTimelineSave");i.button("loading");var t={formSelector:$(this),url:opdTimelineCreateUrl,type:"POST",tableSelector:"#tbl"};newRecord(t,i,"#addOpdTimelineModal"),setTimeout((function(){getOpdTimelines($("#opdPatientDepartmentId").val())}),500)})),$(document).on("click",".edit-timeline-btn",(function(){if(!ajaxCallIsRunning){ajaxCallInProgress();var e=$(this).data("timeline-id");renderTimelineData(e)}})),window.renderTimelineData=function(e){$.ajax({url:opdTimelinesUrl+"/"+e+"/edit",type:"GET",success:function(e){if(e.success){if(""!=e.data.opd_timeline_document_url){var i=e.data.opd_timeline_document_url.split(".").pop().toLowerCase();"pdf"==i?$("#editPreviewTimelineImage").attr("src",pdfDocumentImageUrl):"docx"==i||"doc"==i?$("#editPreviewTimelineImage").attr("src",docxDocumentImageUrl):$("#editPreviewTimelineImage").attr("src",e.data.opd_timeline_document_url),$("#timeDocumentUrl").show()}else $("#timeDocumentUrl").hide(),$("#editPreviewTimelineImage").attr("src",defaultDocumentImageUrl);$("#opdTimelineId").val(e.data.id),$("#editTimelineTitle").val(e.data.title),$("#editTimelineDate").val(e.data.date),$("#editTimelineDescription").val(e.data.description),$("#timeDocumentUrl").attr("href",e.data.opd_timeline_document_url),1==e.data.visible_to_person?$("#editTimelineVisibleToPerson").prop("checked",!0):$("#editTimelineVisibleToPerson").prop("checked",!1),$("#editOpdTimelineModal").modal("show"),ajaxCallCompleted()}},error:function(e){manageAjaxErrors(e)}})},$(document).on("submit","#editOpdTimelineForm",(function(e){e.preventDefault();var i=jQuery(this).find("#btnOpdTimelineEdit");i.button("loading");var t=$("#opdTimelineId").val(),n=opdTimelinesUrl+"/"+t,o={formSelector:$(this),url:n,type:"POST",tableSelector:"#tbl"};editRecord(o,i,"#editOpdTimelineModal"),setTimeout((function(){location.reload()}),500)})),$(document).on("click",".delete-timeline-btn",(function(){var e=$(this).data("timeline-id");deleteOpdTimelineItem(opdTimelinesUrl+"/"+e,"OPD Timeline")})),window.deleteOpdTimelineItem=function(e,i){swal({title:"Delete !",text:'Are you sure want to delete this "'+i+'" ?',type:"warning",showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonColor:"#5cb85c",cancelButtonColor:"#d33",cancelButtonText:"No",confirmButtonText:"Yes"},(function(){$.ajax({url:e,type:"DELETE",dataType:"json",success:function(e){e.success&&setTimeout((function(){getOpdTimelines($("#opdPatientDepartmentId").val())}),500),swal({title:"Deleted!",text:i+" has been deleted.",type:"success",timer:2e3})},error:function(e){swal({title:"",text:e.responseJSON.message,type:"error",timer:5e3})}})}))},$("#addOpdTimelineModal").on("hidden.bs.modal",(function(){resetModalForm("#addOpdTimelineNewForm","#timeLinevalidationErrorsBox"),$("#previewTimelineImage").attr("src",defaultDocumentImageUrl)})),$("#editOpdTimelineModal").on("hidden.bs.modal",(function(){resetModalForm("#editOpdTimelineForm","#editTimelineValidationErrorsBox")}))})),$(document).on("change","#timelineDocumentImage",(function(){var e=isValidTimelineDocument($(this),"#timeLinevalidationErrorsBox");isEmpty(e)||0==e||($("#timeLinevalidationErrorsBox").html("").hide(),displayDocument(this,"#previewTimelineImage",e))})),$(document).on("change","#editTimelineDocumentImage",(function(){var e=isValidTimelineDocument($(this),"#editTimelineValidationErrorsBox");isEmpty(e)||0==e||($("#editTimelineValidationErrorsBox").html("").hide(),displayDocument(this,"#editPreviewTimelineImage",e))})),window.isValidTimelineDocument=function(e,i){var t=$(e).val().split(".").pop().toLowerCase();return-1==$.inArray(t,["png","jpg","jpeg","pdf","doc","docx"])?($(e).val(""),$(i).html("The document must be a file of type: jpeg, jpg, png, pdf, doc, docx.").show(),!1):t},window.getOpdTimelines=function(e){$.ajax({url:opdTimelinesUrl,type:"get",data:{id:e},success:function(e){$("#opdTimelines").html(e)}})};