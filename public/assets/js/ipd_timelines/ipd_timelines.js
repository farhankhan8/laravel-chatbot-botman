$(document).ready((function(){"use strict";getIpdTimelines($("#ipdPatientDepartmentId").val()),$("#timelineDate, #editTimelineDate").datetimepicker(DatetimepickerDefaults({format:"YYYY-MM-DD",useCurrent:!0,sideBySide:!0,minDate:ipdPatientCaseDate})),$(document).on("submit","#addIpdTimelineNewForm",(function(e){e.preventDefault();var i=jQuery(this).find("#btnIpdTimelineSave");i.button("loading");var t={formSelector:$(this),url:ipdTimelineCreateUrl,type:"POST",tableSelector:"#tbl"};newRecord(t,i,"#addIpdTimelineModal"),setTimeout((function(){getIpdTimelines($("#ipdPatientDepartmentId").val())}),500)})),$(document).on("click",".edit-timeline-btn",(function(){if(!ajaxCallIsRunning){ajaxCallInProgress();var e=$(this).data("timeline-id");renderTimelineData(e)}})),window.renderTimelineData=function(e){$.ajax({url:ipdTimelinesUrl+"/"+e+"/edit",type:"GET",success:function(e){if(e.success){if(""!=e.data.ipd_timeline_document_url){var i=e.data.ipd_timeline_document_url.split(".").pop().toLowerCase();"pdf"==i?$("#editPreviewTimelineImage").attr("src",pdfDocumentImageUrl):"docx"==i||"doc"==i?$("#editPreviewTimelineImage").attr("src",docxDocumentImageUrl):$("#editPreviewTimelineImage").attr("src",e.data.ipd_timeline_document_url),$("#timeDocumentUrl").show()}else $("#timeDocumentUrl").hide(),$("#editPreviewTimelineImage").attr("src",defaultDocumentImageUrl);$("#ipdTimelineId").val(e.data.id),$("#editTimelineTitle").val(e.data.title),$("#editTimelineDate").val(e.data.date),$("#editTimelineDescription").val(e.data.description),$("#timeDocumentUrl").attr("href",e.data.ipd_timeline_document_url),1==e.data.visible_to_person?$("#editTimelineVisibleToPerson").prop("checked",!0):$("#editTimelineVisibleToPerson").prop("checked",!1),$("#editIpdTimelineModal").modal("show"),ajaxCallCompleted()}},error:function(e){manageAjaxErrors(e)}})},$(document).on("submit","#editIpdTimelineForm",(function(e){e.preventDefault();var i=jQuery(this).find("#btnIpdTimelineEdit");i.button("loading");var t=$("#ipdTimelineId").val(),n=ipdTimelinesUrl+"/"+t,d={formSelector:$(this),url:n,type:"POST",tableSelector:"#tbl"};editRecord(d,i,"#editIpdTimelineModal"),setTimeout((function(){location.reload()}),500)})),$(document).on("click",".delete-timeline-btn",(function(){var e=$(this).data("timeline-id");deleteIpdTimelineItem(ipdTimelinesUrl+"/"+e,"IPD Timeline")})),window.deleteIpdTimelineItem=function(e,i){swal({title:"Delete !",text:'Are you sure want to delete this "'+i+'" ?',type:"warning",showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonColor:"#5cb85c",cancelButtonColor:"#d33",cancelButtonText:"No",confirmButtonText:"Yes"},(function(){$.ajax({url:e,type:"DELETE",dataType:"json",success:function(e){e.success&&setTimeout((function(){getIpdTimelines($("#ipdPatientDepartmentId").val())}),500),swal({title:"Deleted!",text:i+" has been deleted.",type:"success",timer:2e3})},error:function(e){swal({title:"",text:e.responseJSON.message,type:"error",timer:5e3})}})}))},$("#addIpdTimelineModal").on("hidden.bs.modal",(function(){resetModalForm("#addIpdTimelineNewForm","#validationErrorsBox"),$("#previewTimelineImage").attr("src",defaultDocumentImageUrl)})),$("#editIpdTimelineModal").on("hidden.bs.modal",(function(){resetModalForm("#editIpdTimelineForm","#editValidationErrorsBox")}))})),$(document).on("change","#timelineDocumentImage",(function(){var e=isValidTimelineDocument($(this),"#validationErrorsBox");isEmpty(e)||0==e||($("#validationErrorsBox").html("").hide(),displayDocument(this,"#previewTimelineImage",e))})),$(document).on("change","#editTimelineDocumentImage",(function(){var e=isValidTimelineDocument($(this),"#editValidationErrorsBox");isEmpty(e)||0==e||($("#editValidationErrorsBox").html("").hide(),displayDocument(this,"#editPreviewTimelineImage",e))})),window.isValidTimelineDocument=function(e,i){var t=$(e).val().split(".").pop().toLowerCase();return-1==$.inArray(t,["png","jpg","jpeg","pdf","doc","docx"])?($(e).val(""),$(i).html("The document must be a file of type: jpeg, jpg, png, pdf, doc, docx.").show(),!1):t},window.getIpdTimelines=function(e){$.ajax({url:ipdTimelinesUrl,type:"get",data:{id:e},success:function(e){$("#ipdTimelines").html(e)}})};