(()=>{"use strict";$("#bloodIssuesTable").DataTable({processing:!0,serverSide:!0,order:[[0,"desc"]],ajax:{url:bloodIssueUrl},columnDefs:[{targets:[6],orderable:!1,className:"text-center",width:"8%"},{targets:[5],className:"text-right"},{targets:"_all",defaultContent:"N/A"}],columns:[{data:function(e){return e},render:function(e){return null===e.issue_date?"N/A":moment(e.issue_date).format("Do MMM, Y h:mm A")},name:"issue_date"},{data:"doctor.user.full_name",name:"doctor.user.first_name"},{data:"patient.user.full_name",name:"patient.user.first_name"},{data:"blooddonor.name",name:"blooddonor.name"},{data:"blooddonor.blood_group",name:"blooddonor.blood_group"},{data:function(e){return isEmpty(e.amount)?"N/A":'<p class="cur-margin">'+getCurrentCurrencyClass()+" "+addCommas(e.amount)+"</p>"},name:"amount"},{data:function(e){var a=[{id:e.id}];return prepareTemplateRender("#bloodIssueActionTemplate",a)},name:"patient.user.last_name"}]});$(document).on("submit","#addNewForm",(function(e){e.preventDefault();var a=jQuery(this).find("#btnSave");a.button("loading"),$.ajax({url:bloodIssueCreateUrl,type:"POST",data:$(this).serialize(),success:function(e){e.success&&(displaySuccessMessage(e.message),$("#addModal").modal("hide"),$("#bloodIssuesTable").DataTable().ajax.reload(null,!1),setTimeout((function(){a.button("reset")}),2500))},error:function(e){printErrorMessage("#validationErrorsBox",e),setTimeout((function(){a.button("reset")}),2e3)}})})),$("#donorName").on("change",(function(){changeBloodGroup("#bloodGroup",$(this).val())})),$("#editDonorName").on("change",(function(){changeBloodGroup("#editBloodGroup",$(this).val())})),window.changeBloodGroup=function(e,a){$.ajax({url:bloodGroupUrl,type:"get",dataType:"json",data:{id:a},success:function(a){$(e).empty(),$.each(a.data,(function(a,t){$(e).append($("<option></option>").attr("value",a).text(t))}))}})},$(document).on("submit","#editForm",(function(e){e.preventDefault();var a=jQuery(this).find("#btnEditSave");a.button("loading");var t=$("#bloodIssueId").val();$.ajax({url:bloodIssueUrl+"/"+t,type:"post",data:$(this).serialize(),success:function(e){e.success&&(displaySuccessMessage(e.message),$("#editModal").modal("hide"),$("#bloodIssuesTable").DataTable().ajax.reload(null,!1))},error:function(e){manageAjaxErrors(e)},complete:function(){a.button("reset")}})})),$("#addModal").on("hidden.bs.modal",(function(){resetModalForm("#addNewForm","#validationErrorsBox")})),$("#editModal").on("hidden.bs.modal",(function(){resetModalForm("#editForm","#editValidationErrorsBox")})),window.renderData=function(e){$.ajax({url:bloodIssueUrl+"/"+e+"/edit",type:"GET",success:function(e){if(e.success){var a=e.data;$("#bloodIssueId").val(a.id),$("#editIssueDate").val(moment(a.issue_date).format("YYYY-MM-DD HH:mm:ss")),$("#editDoctorName").val(a.doctor_id).trigger("change"),$("#editPatientName").val(a.patient_id).trigger("change"),$("#editDonorName").val(a.donor_id).trigger("change",[{isEdit:!0}]),$("#editAmount").val(a.amount),$(".price-input").trigger("input"),$("#editRemarks").val(a.remarks),$("#editModal").modal("show"),ajaxCallCompleted()}},error:function(e){manageAjaxErrors(e)}})},$(document).on("click",".edit-btn",(function(e){if(!ajaxCallIsRunning){ajaxCallInProgress();var a=$(e.currentTarget).data("id");renderData(a)}})),$(document).on("click",".delete-btn",(function(e){var a=$(e.currentTarget).data("id");deleteItem(bloodIssueUrl+"/"+a,"#bloodIssuesTable","Blood Issue")})),$(document).ready((function(){$("#doctorName,#patientName,#donorName,#bloodGroup,#editDoctorName,#editPatientName,#editDonorName,#editBloodGroup").select2({width:"100%"}),$("#issueDate,#editIssueDate").datetimepicker(DatetimepickerDefaults({format:"YYYY-MM-DD HH:mm:ss",useCurrent:!0,sideBySide:!0,maxDate:new Date}))}))})();