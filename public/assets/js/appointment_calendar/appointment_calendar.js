$(document).ready((function(){"use strict";var e,t;$("#patientIdAppointment, #doctorIdAppointment").select2({width:"100%"}),screenLock(),$.ajax({url:"calendar-list",type:"GET",dataType:"json",success:function(e){screenUnLock(),$("#calendar").fullCalendar({themeSystem:"bootstrap4",height:750,header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},buttonText:{today:todayText,month:monthText,week:weekText,day:dayText},defaultDate:new Date,defaultView:"month",editable:!1,selectable:!0,eventLimit:!0,views:{month:{eventLimit:5}},selectConstraint:{start:$.fullCalendar.moment().subtract(1,"days"),end:$.fullCalendar.moment().startOf("year").add(1,"year")},selectHelper:!0,select:function(e){var t=e.format("YYYY-MM-DD");$("#opdDateAppointment").val(t),1!=userRole&&$("#addAppointmentModal").modal("show")},eventAfterRender:function(e,t){$(t).tooltip({title:e.title,container:"body"})},events:e.data,timeFormat:"h:mm A",eventAfterAllRender:function(e){setTimeout((function(){$("#calendar button.fc-today-button").removeClass("disabled").prop("disabled",!1)}),100)},eventClick:function(e){showAppointmentDetails(e.id)}})}}),window.showAppointmentDetails=function(e){$.ajax({url:"appointment-detail/"+e,type:"GET",beforeSend:function(){screenLock()},success:function(e){$("#patientName").text(e.data.patient),$("#departmentName").text(e.data.department),$("#doctorName").text(e.data.doctor),$("#opdDate").text(e.data.opdDate),$("#status").text(e.data.status),$("#problem").text(addNewlines(e.data.problem,30)),$(".tooltip ").tooltip("hide"),$("#appointmentDetailModal").modal("show")},complete:function(){screenUnLock()}})},window.addNewlines=function(e,t){var a="";if(null!=e){for(;e.length>0;)a+=e.substring(0,t)+"\n",e=e.substring(t);return a}return"N/A"},window.parseIn=function(e){var t=new Date;return t.setHours(e.substring(11,13)),t.setMinutes(e.substring(14,16)),t},window.getTimeIntervals=function(e,t,a){for(var o=[];e<t;)o.push(e.toTimeString().substring(0,5)),e.setMinutes(e.getMinutes()+a);return o},$(document).on("click",".time-interval",(function(t){var a=$(t.currentTarget).data("id");$(this).data("id")==a&&$(this).parent().hasClass("booked")&&$(".time-slot-book").css("background-color","#ffa0a0"),e=$(this).text(),$(".time-slot").removeClass("time-slot-book"),$(this).parent().addClass("time-slot-book")})),$("#calenderAppointmentForm").on("submit",(function(t){if(null==e||""==e)return $("#validationErrorsBox").show().html("Please select appointment time slot"),!1;t.preventDefault(),screenLock();var a=$(this).serialize()+"&time="+e;$.ajax({url:calenderAppointmentSaveUrl,type:"POST",dataType:"json",data:a,success:function(e){displaySuccessMessage(e.message),window.location.href=calenderIndexPage},error:function(e){printErrorMessage("#validationErrorsBox",e),screenUnLock()}})}));var a,o,n=!1;$("#doctorIdAppointment").on("change",(function(){if(n&&($(".error-message").css("display","none"),n=!0),$(".error-message").css("display","none"),t=$(this).val(),n=!0,""!==$("#opdDateAppointment").val()){if($(".doctor-schedule").css("display","none"),$(".error-message").css("display","none"),$(".available-slot-heading").css("display","none"),$(".color-information").css("display","none"),$(".time-slot").remove(),""==$("#doctorIdAppintment").val())return $("#validationErrorsBox").show().html("Please select Doctor"),$("#validationErrorsBox").delay(5e3).fadeOut(),$("#opdDateAppointment").val(""),$("#opdDateAppointment").data("DateTimePicker").clear(),!1;var e=$("#opdDateAppointment").val(),s=new Date(e),i=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][new Date(s.getTime()+6e4*s.getTimezoneOffset()).getDay()];if(null==i||""==i)return!1;$.ajax({type:"GET",url:doctorScheduleList,data:{day_name:i,doctor_id:t},success:function(t){if(t.success&&""!=t.data)if(0!=t.data.scheduleDay.length){var o=e+" "+t.data.scheduleDay[0].available_from,n=e+" "+t.data.scheduleDay[0].available_to,s=t.data.perPatientTime[0].per_patient_time.split(":"),i=60*+s[0]+ +s[1],l=parseIn(o),r=parseIn(n);if((a=getTimeIntervals(l,r,i)).length>0){var d;$(".available-slot-heading").css("display","block"),$(".color-information").css("display","block");var c="";for(d=0;d<a.length;++d){var p=[{index:d,timeSlot:a[d]}];c+=prepareTemplateRender("#appointmentSlotTemplate",p)}$(".available-slot").append(c)}"00:00:00"!=t.data.scheduleDay[0].available_from&&"00:00:00"!=t.data.scheduleDay[0].available_to&&o!=n?($(".doctor-schedule").css("display","block"),$(".color-information").css("display","block"),$(".day-name").html(t.data.scheduleDay[0].available_on),$(".schedule-time").html("["+t.data.scheduleDay[0].available_from+" - "+t.data.scheduleDay[0].available_to+"]")):($(".doctor-schedule").css("display","none"),$(".color-information").css("display","none"),$(".error-message").css("display","block"),$(".error-message").html("Doctor Schedule not available this date."))}else $(".doctor-schedule").css("display","none"),$(".color-information").css("display","none"),$(".error-message").css("display","block"),$(".error-message").html("Doctor Schedule not available this date.")}}),isCreate&&setTimeout((function(){var n=null;isCreate&&(n={editSelectedDate:e,doctor_id:t}),$.ajax({url:getBookingSlot,type:"GET",data:n,success:function(e){o=e.data.bookingSlotArr,e.data.hasOwnProperty("onlyTime")?(e.data.bookingSlotArr.length>0&&(editTimeSlot=e.data.onlyTime.toString(),$.each(e.data.bookingSlotArr,(function(e,t){$.each(a,(function(e,a){t==a&&$(".time-interval").each((function(){$(this).data("id")==e&&$(this).html()!=editTimeSlot&&($(this).parent().css({"background-color":"#ffa721",border:"1px solid #ffa721",color:"#ffffff"}),$(this).parent().addClass("booked"),$(this).parent().children().prop("disabled",!0))}))}))}))),$(".time-interval").each((function(){$(this).html()==editTimeSlot&&e.data.bookingSlotArr.length>0&&($(this).parent().addClass("time-slot-book"),$(this).parent().removeClass("booked"),$(this).parent().children().prop("disabled",!1),$(this).click())}))):o.length>0&&$.each(o,(function(e,t){$.each(a,(function(e,a){t==a&&$(".time-interval").each((function(){$(this).data("id")==e&&($(this).parent().addClass("time-slot-book"),$(".time-slot-book").css({"background-color":"#ffa721",border:"1px solid #ffa721",color:"#ffffff"}),$(this).parent().addClass("booked"),$(this).parent().children().prop("disabled",!0))}))}))}))}})}),200)}})),$("#addAppointmentModal").on("hidden.bs.modal",(function(){resetModalForm("#calenderAppointmentForm","#validationErrorsBox"),$(".day-name").html(""),$(".schedule-time").html(""),$(".doctor-schedule").css("display","none"),$(".error-message").css("display","none"),$(".available-slot-heading").css("display","none"),$(".available-slot").html(""),$(".color-information").css("display","none"),e=null}))}));