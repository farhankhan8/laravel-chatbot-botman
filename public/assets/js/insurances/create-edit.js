$(document).ready((function(){"use strict";function e(){var e=1;$(".disease-item-container>tr").each((function(){$(this).find(".item-number").text(e),e++})),e-1==0&&($("#total").text("0"),$("#billTbl tbody").append('<tr><td class="text-center item-number">1</td><td><input class="form-control disease-name" required name="disease_name[]" type="text"></td><td><input class="form-control disease-charge price-input" required name="disease_charge[]" type="text"></td><td class="text-center"><i class="fa fa-trash text-danger delete-disease pointer"></i></td></tr>'))}$(".price-input").trigger("input"),discount<0&&$(".discount").val(0),$("#discountId").blur((function(){0==$("#discountId").val().length&&$("#discountId").val(0)})),$("#insuranceForm").find("input:text:visible:first").focus(),window.isNumberKey=function(e,t){var n=e.which?e.which:event.keyCode;return!((46!==n||-1!==$(t).val().indexOf("."))&&(n<48||n>57))},$(document).on("click","#addItem",(function(){var t={uniqueId},n=prepareTemplateRender("#insuranceDiseaseTemplate",t);$(".disease-item-container").append(n),uniqueId++,e()})),$(document).on("click",".delete-disease",(function(){$(this).parents("tr").remove(),e(),calculateAndSetInvoiceAmount()})),$(document).on("change",".service-tax, .discount, .hospital-rate, .disease-charge",(function(){calculateAndSetInvoiceAmount()})),window.calculateAndSetInvoiceAmount=function(){var e=0,t=parseInt(""!==$(".service-tax").val()?removeCommas($(".service-tax").val()):0),n=parseInt(""!==$(".hospital-rate").val()?removeCommas($(".hospital-rate").val()):0),a=parseFloat($(".discount").val());e=t+n,$(".disease-item-container>tr").each((function(){var t=parseInt(""!=$(this).find(".disease-charge").val()?removeCommas($(this).find(".disease-charge").val()):0);e+=t})),e-=e*a/100,$("#total").text(addCommas(e.toFixed(2))),$("#total_amount").val(e)},$(document).on("submit","#insuranceForm",(function(e){e.preventDefault(),screenLock(),$("#saveBtn").attr("disabled",!0);var t=jQuery(this).find("#saveBtn");t.button("loading");var n=new FormData($(this)[0]);$.ajax({url:insuranceSaveUrl,type:"POST",dataType:"json",data:n,processData:!1,contentType:!1,success:function(e){displaySuccessMessage(e.message),window.location.href=insuranceUrl},error:function(e){printErrorMessage("#validationErrorsBox",e),$("#saveBtn").attr("disabled",!1)},complete:function(){screenUnLock(),t.button("reset")}})}))}));