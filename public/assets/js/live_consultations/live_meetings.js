$(document).ready((function(){"use strict";$("#liveMeetingTable").DataTable({processing:!0,serverSide:!0,order:[[0,"desc"]],ajax:{url:liveMeetingUrl,data:function(t){t.status=$("#statusArr").find("option:selected").val()}},columnDefs:[{targets:"_all",defaultContent:"N/A"},{targets:[3],orderable:!1,className:"text-center",width:"10%"},{targets:[5],orderable:!1,className:"text-center",width:"8%"}],columns:[{data:function(t){return'<a href="#" class="show-data" data-id="'+t.id+'">'+t.consultation_title+"</a>"},name:"consultation_title"},{data:function(t){return t},render:function(t){return null===t.consultation_date?"N/A":moment(t.consultation_date,"YYYY-MM-DD hh:mm:ss").format("Do MMM, YYYY hh:mm A")},name:"consultation_date"},{data:"user.full_name",name:"user.first_name"},{data:function(t){return adminRole||doctorRole?'<select class="change-status" data-id="'.concat(t.id,'">')+'<option value="0" '.concat(0==t.status?"selected":"",'>Awaited</option>\n                            <option value="1" ').concat(1==t.status?"selected":"",'>Cancelled</option>\n                            <option value="2" ').concat(2==t.status?"selected":"",">Finished</option>")+"</select>":t.status_text},name:"status"},{data:"password",name:"password"},{data:function(t){var e=[{id:t.id,status:t.status,url:adminRole||doctorRole?t.meta.start_url:t.meta.join_url,title:adminRole||doctorRole?"Start Meeting":"Join Meeting",isDoctor:doctorRole,isAdmin:adminRole,isMeetingFinished:2==t.status}];return prepareTemplateRender("#liveMeetingActionTemplate",e)},name:"user.last_name"}],fnInitComplete:function(){$("#statusArr").change((function(){$("#liveMeetingTable").DataTable().ajax.reload(null,!0)}))},drawCallback:function(){this.api().state.clear(),$(".change-status").select2({width:"100%"})}}),$("#userId,.editUserId, #statusArr").select2({width:"100%"}),$(".consultation-date, .edit-consultation-date").datetimepicker(DatetimepickerDefaults({format:"YYYY-MM-DD h:mm A",useCurrent:!0,sideBySide:!0,minDate:new Date})),$(document).on("submit","#addNewForm",(function(t){t.preventDefault();var e=jQuery(this).find("#btnSave");e.button("loading"),$.ajax({url:liveMeetingCreateUrl,type:"POST",data:$(this).serialize(),success:function(t){t.success&&(displaySuccessMessage(t.message),$("#addModal").modal("hide"),$("#liveMeetingTable").DataTable().ajax.reload(null,!1),setTimeout((function(){e.button("reset")}),2500))},error:function(t){printErrorMessage("#validationErrorsBox",t),setTimeout((function(){e.button("reset")}),2e3)}})})),$("#addModal").on("hidden.bs.modal",(function(){resetModalForm("#addNewForm","#validationErrorsBox"),$("#userId").val(loggedInUserId).trigger("change.select2")})),$(document).on("change",".change-status",(function(){var t=$(this).val();$.ajax({url:liveMeetingUrl+"/change-status",type:"GET",data:{statusId:t,id:$(this).data("id")},success:function(t){t.success&&(displaySuccessMessage(t.message),$("#liveMeetingTable").DataTable().ajax.reload(null,!1))},error:function(t){manageAjaxErrors(t)}})}))})),$(document).on("click",".start-btn",(function(t){if(!ajaxCallIsRunning){ajaxCallInProgress();var e=$(t.currentTarget).data("id");startRenderData(e)}})),window.startRenderData=function(t){$.ajax({url:liveMeetingUrl+"/"+t+"/start",type:"GET",success:function(t){if(t.success){var e=t.data;$("#startLiveConsultationId").val(e.liveMeeting.id),$(".start-modal-title").text(e.liveMeeting.consultation_title),$(".host-name").text(e.liveMeeting.user.full_name),$(".date").text(e.liveMeeting.consultation_date),$(".minutes").text(e.liveMeeting.consultation_duration_minutes),$("#startModal").find(".status").append("started"===e.zoomLiveData.data.status?$(".status").text("Started"):$(".status").text("Awaited")),adminRole||doctorRole?"started"===e.zoomLiveData.data.status?$(".start").addClass("disabled"):$(".start").attr("href",e.liveMeeting.meta.start_url):$(".start").attr("href",e.liveMeeting.meta.join_url),$("#startModal").modal("show"),ajaxCallCompleted()}},error:function(t){manageAjaxErrors(t)}})},$(document).on("click",".show-data",(function(t){var e=$(t.currentTarget).data("id");$.ajax({url:liveMeetingUrl+"/"+e,type:"GET",success:function(t){if(t.success){var e=t.data;$("#showLiveConsultationId").val(e.id),$("#meetingTitle").text(e.consultation_title),$("#meetingDate").text(e.consultation_date),$("#meetingMinutes").text(e.consultation_duration_minutes),0==e.host_video?$("#meetingHost").text("Disable"):$("#meetingHost").text("Enable"),0==e.participant_video?$("#meetingParticipant").text("Disable"):$("#meetingParticipant").text("Enable"),isEmpty(e.description)?$("#meetingDescription").text("N/A"):$("#meetingDescription").text(e.description),$("#showModal").modal("show")}},error:function(t){manageAjaxErrors(t)}})})),$(document).on("click",".edit-btn",(function(t){if(!ajaxCallIsRunning){ajaxCallInProgress();var e=$(t.currentTarget).data("id");renderData(e)}})),window.renderData=function(t){$.ajax({url:liveMeetingUrl+"/"+t+"/edit",type:"GET",success:function(t){if(t.success){var e=t.data;$("#liveMeetingId").val(e.id),$(".edit-consultation-title").val(e.consultation_title),$(".edit-consultation-date").val(moment(e.consultation_date).format("YYYY-MM-DD h:mm A")),$(".edit-consultation-duration-minutes").val(e.consultation_duration_minutes),$(".editUserId").val(e.meetingUsers).trigger("change.select2"),$(".host-enable,.host-disabled").prop("checked",!1),e.host_video,$('input[name="host_video"][value='.concat(e.host_video,"]")).prop("checked",!0),$(".client-enable,.client-disabled").prop("checked",!1),e.participant_video,$('input[name="participant_video"][value='.concat(e.participant_video,"]")).prop("checked",!0),$(".edit-description").val(e.description),$("#editModal").modal("show"),ajaxCallCompleted()}},error:function(t){manageAjaxErrors(t)}})},$(document).on("submit","#editForm",(function(t){t.preventDefault();var e=jQuery(this).find("#btnEditSave");e.button("loading");var a=$("#liveMeetingId").val();$.ajax({url:liveMeetingUrl+"/"+a,type:"post",data:$(this).serialize(),success:function(t){t.success&&(displaySuccessMessage(t.message),$("#editModal").modal("hide"),$("#liveMeetingTable").DataTable().ajax.reload(null,!1))},error:function(t){manageAjaxErrors(t)},complete:function(){e.button("reset")}})})),$(document).on("click",".delete-btn",(function(t){var e=$(t.currentTarget).data("id");deleteItem(liveMeetingUrl+"/"+e,"#liveMeetingTable","Live Meeting")})),$("#showModal").on("hidden.bs.modal",(function(){$(this).find("#meetingTitle,#meetingDate, #meetingMinutes, #meetingHost, #meetingParticipant, #meetingDescription").empty()}));