(()=>{"use strict";$("#liveConsultationTable").DataTable({processing:!0,serverSide:!0,order:[[0,"desc"]],ajax:{url:liveConsultationUrl,data:function(t){t.status=$("#statusArr").find("option:selected").val()}},columnDefs:[{targets:"_all",defaultContent:"N/A"},{targets:[1],width:"15%"},{targets:[5,7],orderable:!1,className:"text-center",width:"8%"}],columns:[{data:function(t){return'<a href="#" class="show-data" data-id="'+t.id+'">'+t.consultation_title+"</a>"},name:"consultation_title"},{data:function(t){return t},render:function(t){return null===t.consultation_date?"N/A":moment(t.consultation_date,"YYYY-MM-DD hh:mm:ss").format("Do MMM, YYYY hh:mm A")},name:"consultation_date"},{data:"user.full_name",name:"user.first_name"},{data:"doctor.user.full_name",name:"doctor.user.first_name"},{data:"patient.user.full_name",name:"patient.user.first_name"},{data:function(t){return adminRole||doctorRole?'<select class="change-status" data-id="'.concat(t.id,'">')+'<option value="0" '.concat(0==t.status?"selected":"",'>Awaited</option>\n                            <option value="1" ').concat(1==t.status?"selected":"",'>Cancelled</option>\n                            <option value="2" ').concat(2==t.status?"selected":"",">Finished</option>")+"</select>":t.status_text},name:"user.last_name"},{data:"password",name:"password"},{data:function(t){var e=[{id:t.id,status:t.status,url:patientRole?t.meta.join_url:t.meta.start_url,title:patientRole?"Join Meeting":"Start Meeting",isDoctor:doctorRole,isAdmin:adminRole,isMeetingFinished:2==t.status}];return prepareTemplateRender("#liveConsultationActionTemplate",e)},name:"patient.user.last_name"}],fnInitComplete:function(){$("#statusArr").change((function(){$("#liveConsultationTable").DataTable().ajax.reload(null,!0)}))},drawCallback:function(){this.api().state.clear(),$(".change-status").select2({width:"100%"})}});$("#addModal").on("hidden.bs.modal",(function(){resetModalForm("#addNewForm","#validationErrorsBox")})),$("#editModal").on("hidden.bs.modal",(function(){resetModalForm("#editForm","#editValidationErrorsBox")}));var t=null;$(".consultation-type, .edit-consultation-type").on("change",(function(){changeTypeNumber(".consultation-type-number, .edit-consultation-type-number",$(this).val(),t)})),$(".patient-name, .edit-patient-name").on("change",(function(){""!==$(this).val()&&(t=$(this).val(),$(".consultation-type, .edit-consultation-type").removeAttr("disabled"))})),window.changeTypeNumber=function(t,e,a){""!==$(this).val()&&$.ajax({url:liveConsultationTypeNumber,type:"get",dataType:"json",data:{consultation_type:e,patient_id:a},success:function(e){0!==e.data.length?($(t).empty(),$(t).removeAttr("disabled"),$.each(e.data,(function(e,a){$(t).append($("<option></option>").attr("value",e).text(a))}))):$(t).prop("disabled",!0)}}),$(t).empty(),$(t).prop("disabled",!0)},$(document).ready((function(){$(".doctor-name,.patient-name,.consultation-type,.consultation-type-number,.change-status, .edit-doctor-name,.edit-patient-name,.edit-consultation-type,.edit-consultation-type-number,.edit-change-status, #statusArr").select2({width:"100%"}),$(".consultation-date, .edit-consultation-date").datetimepicker(DatetimepickerDefaults({format:"YYYY-MM-DD h:mm A",useCurrent:!0,sideBySide:!0,minDate:new Date}))})),$(document).on("submit","#addNewForm",(function(t){t.preventDefault();var e=jQuery(this).find("#btnSave");e.button("loading"),$.ajax({url:liveConsultationCreateUrl,type:"POST",data:$(this).serialize(),success:function(t){t.success&&(displaySuccessMessage(t.message),$("#addModal").modal("hide"),$("#liveConsultationTable").DataTable().ajax.reload(null,!1),setTimeout((function(){e.button("reset")}),2500))},error:function(t){printErrorMessage("#validationErrorsBox",t),setTimeout((function(){e.button("reset")}),2e3)}})})),$(document).on("submit","#editForm",(function(t){t.preventDefault();var e=jQuery(this).find("#btnEditSave");e.button("loading");var a=$("#liveConsultationId").val();$.ajax({url:liveConsultationUrl+"/"+a,type:"post",data:$(this).serialize(),success:function(t){t.success&&(displaySuccessMessage(t.message),$("#editModal").modal("hide"),$("#liveConsultationTable").DataTable().ajax.reload(null,!1))},error:function(t){manageAjaxErrors(t)},complete:function(){e.button("reset")}})})),window.renderData=function(t){$.ajax({url:liveConsultationUrl+"/"+t+"/edit",type:"GET",success:function(t){if(t.success){var e=t.data;$("#liveConsultationId").val(e.id),$(".edit-consultation-title").val(e.consultation_title),$(".edit-consultation-date").val(moment(e.consultation_date).format("YYYY-MM-DD h:mm A")),$(".edit-consultation-duration-minutes").val(e.consultation_duration_minutes),$(".edit-patient-name").val(e.patient_id).trigger("change"),$(".edit-doctor-name").val(e.doctor_id).trigger("change"),$(".host-enable,.host-disabled").prop("checked",!1),e.host_video,$('input[name="host_video"][value='.concat(e.host_video,"]")).prop("checked",!0),$(".client-enable,.client-disabled").prop("checked",!1),e.participant_video,$('input[name="participant_video"][value='.concat(e.participant_video,"]")).prop("checked",!0),$(".edit-consultation-type").val(e.type).trigger("change"),$(".edit-consultation-type-number").val(e.type_number).trigger("change"),$(".edit-description").val(e.description),$("#editModal").modal("show"),ajaxCallCompleted()}},error:function(t){manageAjaxErrors(t)}})},$(document).on("click",".edit-btn",(function(t){if(!ajaxCallIsRunning){ajaxCallInProgress();var e=$(t.currentTarget).data("id");renderData(e)}})),$(document).on("click",".start-btn",(function(t){if(!ajaxCallIsRunning){ajaxCallInProgress();var e=$(t.currentTarget).data("id");startRenderData(e)}})),window.startRenderData=function(t){$.ajax({url:liveConsultationUrl+"/"+t+"/start",type:"GET",success:function(t){if(t.success){var e=t.data;$("#startLiveConsultationId").val(e.liveConsultation.id),$(".start-modal-title").text(e.liveConsultation.consultation_title),$(".host-name").text(e.liveConsultation.user.full_name),$(".date").text(e.liveConsultation.consultation_date),$(".minutes").text(e.liveConsultation.consultation_duration_minutes),$("#startModal").find(".status").append("started"===e.zoomLiveData.data.status?$(".status").text("Started"):$(".status").text("Awaited")),$(".start").attr("href",patientRole?e.liveConsultation.meta.join_url:"started"===e.zoomLiveData.data.status?$(".start").addClass("disabled"):e.liveConsultation.meta.start_url),$("#startModal").modal("show"),ajaxCallCompleted()}},error:function(t){manageAjaxErrors(t)}})},$(document).on("click",".delete-btn",(function(t){var e=$(t.currentTarget).data("id");deleteItem(liveConsultationUrl+"/"+e,"#liveConsultationTable","Live Consultation")})),$(document).on("change",".change-status",(function(){var t=$(this).val();$.ajax({url:liveConsultationUrl+"/change-status",type:"GET",data:{statusId:t,id:$(this).data("id")},success:function(t){t.success&&(displaySuccessMessage(t.message),$("#liveConsultationTable").DataTable().ajax.reload(null,!1))},error:function(t){manageAjaxErrors(t)}})})),$(document).on("click",".show-data",(function(t){var e=$(t.currentTarget).data("id");$.ajax({url:liveConsultationUrl+"/"+e,type:"GET",success:function(t){if(t.success){var e=t.data.liveConsultation,a=$("#showModal");$("#startLiveConsultationId").val(e.id),$("#consultationTitle").text(e.consultation_title),$("#consultationDate").text(e.consultation_date),$("#consultationDurationMinutes").text(e.consultation_duration_minutes),$("#consultationPatient").text(e.patient.user.full_name),$("#consultationDoctor").text(e.doctor.user.full_name),0==e.type?a.find("#consultationType").append("OPD"):a.find("#consultationType").append("IPD"),0==e.type?a.find("#consultationTypeNumber").append(e.opd_patient.opd_number):a.find("#consultationTypeNumber").append(e.ipd_patient.ipd_number),0===e.host_video?$("#consultationHostVideo").text("Disable"):$("#consultationHostVideo").text("Enable"),0===e.participant_video?$("#consultationParticipantVideo").text("Disable"):$("#consultationParticipantVideo").text("Enable"),isEmpty(e.description)?$("#consultationDescription").text("N/A"):$("#consultationDescription").text(e.description),a.modal("show")}},error:function(t){manageAjaxErrors(t)}})})),$("#showModal").on("hidden.bs.modal",(function(){$(this).find("#consultationTitle, #consultationDate, #consultationDurationMinutes, #consultationPatient, #consultationDoctor, #consultationType, #consultationTypeNumber, #consultationHostVideo, #consultationParticipantVideo, #consultationDescription").empty()})),$(document).on("click",".add-credential",(function(){if(!ajaxCallIsRunning){ajaxCallInProgress();var t=$("#userId").val();userZoomRenderData(t)}})),window.userZoomRenderData=function(t){$.ajax({url:"user-zoom-credential/"+t+"/fetch",type:"GET",success:function(t){if(t.success){var e=t.data;isEmpty(e)||($("#zoomApiKey").val(e.zoom_api_key),$("#zoomApiSecret").val(e.zoom_api_secret)),$("#addCredential").modal("show"),ajaxCallCompleted()}},error:function(t){manageAjaxErrors(t)}})},$(document).on("submit","#addZoomForm",(function(t){t.preventDefault();var e=jQuery(this).find("#btnZoomSave");e.button("loading"),$.ajax({url:zoomCredentialCreateUrl,type:"POST",data:$(this).serialize(),success:function(t){t.success&&(displaySuccessMessage(t.message),$("#addCredential").modal("hide"),setTimeout((function(){e.button("reset")}),2500))},error:function(t){printErrorMessage("#credentialValidationErrorsBox",t),setTimeout((function(){e.button("reset")}),2e3)}})}))})();