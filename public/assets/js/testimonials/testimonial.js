(()=>{"use strict";var a="#testimonialTbl";$("#testimonialTbl").DataTable({processing:!0,serverSide:!0,order:[[1,"asc"]],ajax:{url:testimonialUrl},columnDefs:[{targets:[0,3],orderable:!1,className:"text-center",width:"8%"},{targets:"_all",defaultContent:"N/A"}],columns:[{data:function(a){return'<img src="'.concat(a.document_url,'" class="user-img image-stretching">')},name:"id"},{data:"name",name:"name"},{data:"description",name:"description"},{data:function(a){var e=[{id:a.id}];return prepareTemplateRender("#testimonialActionTemplate",e)},name:"id"}]});$(document).on("submit","#addNewForm",(function(e){e.preventDefault();var t=jQuery(this).find("#btnSave");t.button("loading");var o=new FormData($(this)[0]);$.ajax({url:testimonialCreateUrl,type:"POST",dataType:"json",data:o,processData:!1,contentType:!1,success:function(e){e.success&&(displaySuccessMessage(e.message),$("#addModal").modal("hide"),$(a).DataTable().ajax.reload(null,!1))},error:function(a){printErrorMessage("#validationErrorsBox",a)},complete:function(){t.button("reset")}})})),$(document).on("click",".edit-btn",(function(a){if(!ajaxCallIsRunning){ajaxCallInProgress();var e=$(a.currentTarget).data("id");renderData(e)}})),window.renderData=function(a){$.ajax({url:testimonialUrl+"/"+a+"/edit",type:"GET",success:function(a){a.success&&(""==a.data.document_url.split(".").pop().toLowerCase()?$("#editPreviewImage").attr("src",defaultDocumentImageUrl):$("#editPreviewImage").attr("src",a.data.document_url),$("#testimonialId").val(a.data.id),$("#editName").val(a.data.name),$("#editDescription").val(a.data.description),isEmpty(a.data.document_url)?$("#documentUrl").text(""):($("#documentUrl").html("View"),$("#documentUrl").attr("href",a.data.document_url)),$("#editModal").modal("show"),ajaxCallCompleted())},error:function(a){manageAjaxErrors(a)}})},$(document).on("submit","#editForm",(function(e){e.preventDefault();var t=jQuery(this).find("#btnEditSave");t.button("loading");var o=$("#testimonialId").val(),n=new FormData($(this)[0]);$.ajax({url:testimonialUrl+"/"+o,type:"post",data:n,processData:!1,contentType:!1,success:function(e){e.success&&(displaySuccessMessage(e.message),$("#editModal").modal("hide"),$(a).DataTable().ajax.reload(null,!1))},error:function(a){manageAjaxErrors(a)},complete:function(){t.button("reset")}})})),$("#addModal").on("hidden.bs.modal",(function(){resetModalForm("#addNewForm","#addModal #validationErrorsBox"),$("#previewImage").attr("src",defaultDocumentImageUrl)})),$("#addModal").on("shown.bs.modal",(function(){$("#addModal #validationErrorsBox").show(),$("#addModal #validationErrorsBox").addClass("d-none")})),$("#editModal").on("hidden.bs.modal",(function(){resetModalForm("#editForm","#editModal #editValidationErrorsBox"),$("#previewImage").attr("src",defaultDocumentImageUrl)})),$("#editModal").on("shown.bs.modal",(function(){$("#editModal #editValidationErrorsBox").show(),$("#editModal #editValidationErrorsBox").addClass("d-none")})),$(document).on("click",".delete-btn",(function(e){var t=$(e.currentTarget).data("id");deleteItem(testimonialUrl+"/"+t,a,"Testimonial")})),$(document).on("change","#profile",(function(){var a=isValidDocument($(this),"#addModal #validationErrorsBox");isEmpty(a)||0==a||displayDocument(this,"#previewImage",a)})),$(document).on("change","#editProfile",(function(){var a=isValidDocument($(this),"#editModal #editValidationErrorsBox");isEmpty(a)||0==a||displayDocument(this,"#editPreviewImage",a)})),window.isValidDocument=function(a,e){var t=$(a).val().split(".").pop().toLowerCase();return-1==$.inArray(t,["png","jpg","jpeg"])?($(a).val(""),$(e).html(profileError).removeClass("d-none"),!1):($(e).html(profileError).addClass("d-none"),t)}})();